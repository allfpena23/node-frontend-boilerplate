# Frontend Boilerplate

# Rapid Service API

[![RAPiD Checklist](https://img.shields.io/badge/RAPiD-Checklist-red)](https://docs.google.com/spreadsheets/d/1PvxwAqT64vbaXCH0NaZEriyD_n-nFdjMFaQd-u54jyk/edit#gid=1875727837)
[![Workflow](https://img.shields.io/badge/Roadmap-Workflow_1-orange)](https://app.diagrams.net/#G167jaokVjBBXWHwOOJLcKtFj71uYLA1Yd)
[![Workflow](https://img.shields.io/badge/Roadmap-Workflow_2-yellow)](https://app.diagrams.net/#G1AOlNcNOA6Y6XSiN7AjK_nZJg4Bjxylky)

[![RAPiD GCP Checklist](https://img.shields.io/badge/RAPiD_GCP-Checklist-green)](https://docs.google.com/spreadsheets/d/1BbwugPZrHjplKDrOFmKpazMB0cuJRRnvet3CR1BEtOc/edit#gid=66597012)

## Installation

---

### Database Setup

- Create schema rapidpr, envmatrixall and audit
- Generate tables via api endpoint `{base_url}/db/sync?schema={schema}[&force={true|false}][&alter={true|false}][&seeders={seeder:up|down}]`

  - **schema** - schema name ( rapidpr | envmatrixall | audit)
  - **force** - delete and generate all tables under specified schema.
  - **alter** - regenerate tables based on changes in table models
  - **seeders** - start-up data, provide seeder name. seeder codes can be found under action-handlers/seeders. <br>
    (ex. seeders=rpd_environment:up)

- `Note:` To resolve mysql setup in GCP, implemented a local file base db setup using sqlite as a temporary solution <br>
  A mysql and sqlite version of the code exist under ./db directory, create a copy and name it as database.js - database-mysql.js <br> - database-sqlite.js <br>

---

### Environment Setup

- Create `.env.xxx` file in the root directory (`.env.test`). Please check `.env.sample`
- Environment can be `prod|production`, `dev|development` and `test` as default (`NODE_ENV=development`)

<details>
    <summary>.ENV file entries </summary>

| Key                      | Value                                         |
| ------------------------ | --------------------------------------------- |
| DB_HOST                  | localhost                                     |
| DB_DIALECT               | MYSQL / SQLITE                                |
| DB_LOGGING               | false                                         |
| --- WEBLOGIC ---         |
| WL_USER                  | default weblogic user to use                  |
| WL_PASS                  | default weblogic password to use              |
| WL*PASS*[USER]           | weblogic password for specific user           |
| --- RAPiD ---            |
| DB_DATABASE              | rapid database (rapidpr)                      |
| DB_USER                  | rapid user (user)                             |
| DB_PASSWORD              | rapid password (exact or encrypted)           |
| DB_PORT                  | port                                          |
| --- Envmatrixall ---     |
| ENVMATRIXALL_DB_DATABASE | envmatrixall database (envmatrixall)          |
| ENVMATRIXALL_DB_USER     | envmatrixall user (user)                      |
| ENVMATRIXALL_DB_PASSWORD | envmatrixall password (exact or encrypted)    |
| ENVMATRIXALL_DB_PORT     | port                                          |
| --- Audit ---            |
| AUDIT_DB_DATABASE        | audit database (audit)                        |
| AUDIT_DB_USER            | audit user (user)                             |
| AUDIT_DB_PASSWORD        | audit password (exact or encrypted)           |
| AUDIT_DB_PORT            | port                                          |
| AUDIT_LOGGING            | if true, all tables will be audit for changes |
| --- SQLITE OPTION ---    |
| DB_STORAGE               | ./database/env                                |
| --- REMOTE FILE ---      |
| REMOTE_FILE_STORAGE      | ./remotefiles                                 |
| --- Logging ---          |
| LOG_LEVEL                | debug                                         |
| LOG_DIRECTORY            | ./logs                                        |
| --- GCP ---              |
| GCP_STORAGE              | ./bucket name                                 |
| GCP_STORAGE_MAX_AGE      | 1555200 (not working)                         |
| --- WL DOMAIN API ---    |
| WL_DOMAIN_API            | https://wl-emapi.tsl.telus.com/weblogic/1.0   |

</details>

---

### Run the application

- Application have both `http` and `https` protocols
- Certificates for https are autogenerated if it doesn't exist in the root directory

| Script               | Description                                               |
| -------------------- | --------------------------------------------------------- |
| `npm run run:test`   | Start application as test environment (nodemon)           |
| `npm run run:dev`    | Start application as dev environment w/ test (do not use) |
| `npm run win:test`   | Start application as test environment (windows)           |
| `npm run win:dev`    | Start application as dev environment (windows)            |
| `npm run win`        | Start application as prod environment (windows)           |
| `npm run start:test` | Start application as test environment                     |
| `npm run start:dev`  | Start application as development environment              |
| `npm start`          | Start application as prod environment                     |
| `npm run pm2:start`  | Start application via process manager                     |
| `npm run pm2:stop`   | Stop application via process manager                      |

---

## Coding Standards & Guidelines

- **`LOGGING`**

  - include meta to all modules and add it to logger.

    ```js
    const meta = {
      label: path.basename(__filename),
    };

    logger.info("some logs", meta);
    ```

  - common logger is declared as a global variable during application startup.
    ```js
    const logger = global.logger;
    // OR
    const logger = require("logger")();
    ```
  - custom logger
    ```js
    const logFilename = `wls-service-${getDateTimeString()}`;
    const logger = require(path.resolve("logger"))(logFilename);
    ```

- **`Naming Conventions`**

  - If applicable, use the pattern `[model|object]` - `[action]` - `[add'l desc]` <br>
    Ex. `deployment-create` | `dep-create` | `app-state-check`
  - dash-case for filemanes.
  - camelCase for variables.

- **`Code Structure`**

  - functional approach in design
  - for controller codes, if complex, create under action-handlers
  - create modules under action-handlers and use a config map.
    - build - will cover create and deploy of deployment artifacts
    - seeders - start up data
    - weblogic - all weblogic rest api related codes
    - others - create when needed (ex. common - for reusable codes)
  - utility modules - any helper modules at least be under ./util
    - group functionalities whenever applicable (ex. stringUtils.js or dateUtils.js)
    - currently, all functions are under util.js.

- **`Documentation`**

  - Swagger

- **`Testing`**
  - JEST

```mermaid
  graph TD;
      A-->B;
      A-->C;
      B-->D;
      C-->D;
```

testing
again
